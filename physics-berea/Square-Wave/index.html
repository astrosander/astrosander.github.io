<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RC with Square-Wave Input</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;line-height:1.3}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-bottom:16px}
  .ctrl{background:#f6f7f9;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
  .ctrl label{display:flex;justify-content:space-between;font-size:14px;margin-bottom:6px}
  .ctrl input[type="range"]{width:100%}
  .row{display:flex;gap:10px;align-items:center;margin-top:6px}
  .row input[type="number"]{width:90px}
  .tags{font-size:12px;color:#555;margin-top:4px}
  button{padding:8px 12px;border-radius:10px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
  button:active{transform:translateY(1px)}
</style>
</head>
<body>
<h2>RC Response to Square Wave</h2>
<div class="grid">
  <div class="ctrl">
    <label>R (Ω) <span id="Rval">1.00</span></label>
    <input id="R" type="range" min="0.1" max="5" step="0.01" value="1">
    <div class="row"><input id="Rnum" type="number" min="0.1" max="5" step="0.01" value="1"></div>
    <div class="tags">τ = R·C</div>
  </div>
  <div class="ctrl">
    <label>C (F) <span id="Cval">0.10</span></label>
    <input id="C" type="range" min="0.01" max="0.5" step="0.001" value="0.1">
    <div class="row"><input id="Cnum" type="number" min="0.01" max="0.5" step="0.001" value="0.1"></div>
    <div class="tags">v₀ = 0 (discharged capacitor)</div>
  </div>
  <div class="ctrl">
    <label>Frequency f (Hz) <span id="Fval">1.00</span></label>
    <input id="F" type="range" min="0.2" max="5" step="0.01" value="1">
    <div class="row"><input id="Fnum" type="number" min="0.2" max="5" step="0.01" value="1"></div>
    <div class="tags">U(t) = square(2πft), amplitude ±1</div>
  </div>
  <div class="ctrl">
    <label>Duration T (s) <span id="Tval">4.00</span></label>
    <input id="T" type="range" min="1" max="10" step="0.1" value="4">
    <div class="row">
      <input id="Tnum" type="number" min="1" max="10" step="0.1" value="4">
      <button id="reset">Reset to v₀=0</button>
    </div>
    <div class="tags"><label><input id="showInput" type="checkbox" checked> Show input U(t)</label></div>
  </div>
</div>

<div id="plot" style="width:100%;max-width:1100px;height:520px;"></div>

<script>
const N = 2000;

function linspace(a,b,n){
  const d=(b-a)/(n-1), x=new Array(n);
  for(let i=0;i<n;i++) x[i]=a+i*d;
  return x;
}

function simulate(R,C,f,T, v0=null){
  const t = linspace(0,T,N);
  const dt = t[1]-t[0];
  const u = new Array(N);
  const v = new Array(N);
  const tau = R*C;
  
  // Initialize input square wave
  for(let i=0;i<N;i++) u[i] = Math.sin(2*Math.PI*f*t[i])>=0 ? 1 : -1;
  
  // Set proper initial condition for RC circuit
  v[0] = v0 !== null ? v0 : 0; // Start from 0V (discharged capacitor)
  
  // Simulate RC circuit using Euler's method
  for(let i=1;i<N;i++) {
    v[i] = v[i-1] + (dt/tau)*(u[i-1]-v[i-1]);
  }
  
  return {t,u,v};
}

const els = {
  R:document.getElementById('R'), Rnum:document.getElementById('Rnum'), Rval:document.getElementById('Rval'),
  C:document.getElementById('C'), Cnum:document.getElementById('Cnum'), Cval:document.getElementById('Cval'),
  F:document.getElementById('F'), Fnum:document.getElementById('Fnum'), Fval:document.getElementById('Fval'),
  T:document.getElementById('T'), Tnum:document.getElementById('Tnum'), Tval:document.getElementById('Tval'),
  reset:document.getElementById('reset'), showInput:document.getElementById('showInput')
};

function sync(a,b,label,fmt=(x)=>x.toFixed(2)){
  a.addEventListener('input',()=>{ b.value=a.value; label.textContent=fmt(+a.value); draw(); });
  b.addEventListener('input',()=>{ a.value=b.value; label.textContent=fmt(+b.value); draw(); });
}
sync(els.R,els.Rnum,els.Rval);
sync(els.C,els.Cnum,els.Cval);
sync(els.F,els.Fnum,els.Fval);
sync(els.T,els.Tnum,els.Tval);

let rememberedV0 = null;

els.reset.addEventListener('click',()=>{ rememberedV0=null; draw(); });
els.showInput.addEventListener('change',draw);

const layout = {
  margin:{l:50,r:20,t:10,b:40},
  xaxis:{title:'t (s)'},
  yaxis:{title:'Amplitude', rangemode:'tozero'},
  legend:{orientation:'h', x:0, y:1.1}
};

function draw(){
  const R=+els.R.value, C=+els.C.value, f=+els.F.value, T=+els.T.value;
  const {t,u,v} = simulate(R,C,f,T, rememberedV0);
  rememberedV0 = v[0];
  const traces = [
    {x:t,y:v,mode:'lines',name:'Output v(t)'},
  ];
  if(els.showInput.checked) traces.unshift({x:t,y:u,mode:'lines',name:'Input U(t)'});
  Plotly.react('plot', traces, layout, {responsive:true, displayModeBar:false});
}

draw();
</script>
</body>
</html>
