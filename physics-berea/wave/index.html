<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RC Circuit Waveform Response</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  :root {
    --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --surface: rgba(255, 255, 255, 0.95);
    --surface-dark: rgba(0, 0, 0, 0.02);
    --border: rgba(255, 255, 255, 0.2);
    --text-primary: #2d3748;
    --text-secondary: #718096;
    --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  * { box-sizing: border-box; }
  
  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    margin: 0;
    padding: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    min-height: 100vh;
    line-height: 1.6;
    color: var(--text-primary);
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--surface);
    border-radius: 24px;
    padding: 16px;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
  }

  h2 {
    margin: 0 0 8px 0;
    font-size: 1.8rem;
    font-weight: 700;
    background: var(--primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: center;
  }

  .controls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }

  .ctrl {
    background: var(--surface);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: 12px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }

  .ctrl:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .ctrl label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  .ctrl label span {
    background: var(--accent);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
  }

  .ctrl input[type="range"] {
    width: 100%;
    height: 4px;
    border-radius: 2px;
    background: var(--surface-dark);
    outline: none;
    -webkit-appearance: none;
    margin: 6px 0;
  }

  .ctrl input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    box-shadow: var(--shadow);
  }

  .ctrl input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--primary);
    cursor: pointer;
    border: none;
    box-shadow: var(--shadow);
  }

  .row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 8px;
  }

  .row input[type="number"], .row select {
    flex: 1;
    padding: 6px 8px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.5);
    font-size: 12px;
    outline: none;
    transition: all 0.3s ease;
  }

  .row input[type="number"]:focus, .row select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .tags {
    font-size: 10px;
    color: var(--text-secondary);
    margin-top: 6px;
    padding: 4px 8px;
    background: var(--surface-dark);
    border-radius: 4px;
  }

  button {
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: var(--secondary);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 12px;
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow);
  }

  button:active {
    transform: translateY(0);
  }

  .checkbox-container {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 6px;
  }

  .checkbox-container input[type="checkbox"] {
    width: 14px;
    height: 14px;
    accent-color: #667eea;
  }

  .checkbox-container label {
    font-size: 11px;
    margin: 0;
  }

  .plot-container {
    background: var(--surface);
    border-radius: 12px;
    padding: 12px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .meme-section {
    display: flex;
    gap: 12px;
    margin: 16px 0;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }

  .meme-container {
    background: var(--surface);
    border-radius: 12px;
    padding: 10px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
    max-width: 200px;
  }

  .meme-container:hover {
    transform: translateY(-5px) rotate(1deg);
    box-shadow: var(--shadow-lg);
  }

  .meme-container:nth-child(even):hover {
    transform: translateY(-5px) rotate(-1deg);
  }

  .meme-container img {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: var(--shadow);
  }

  .meme-caption {
    text-align: center;
    font-size: 10px;
    font-weight: 600;
    margin-top: 8px;
    color: var(--text-secondary);
    font-style: italic;
  }

  @media (max-width: 768px) {
    .container { padding: 16px; }
    h2 { font-size: 1.5rem; }
    .controls-grid { grid-template-columns: 1fr; }
    .meme-section { flex-direction: column; }
    .meme-container { max-width: 100%; }
  }
</style>
</head>
<body>
<div class="container">
  <h2>RC Circuit Waveform Response</h2>
  
  <div class="controls-grid">
    <div class="ctrl">
      <label>Waveform Type <span id="waveformDisplay">Square</span></label>
      <div class="row">
        <select id="waveform">
          <option value="square">Square Wave</option>
          <option value="sine">Sine Wave</option>
          <option value="triangle">Triangle Wave</option>
          <option value="sawtooth">Sawtooth Wave</option>
        </select>
      </div>
      <div class="tags">Input signal shape: U(t)</div>
    </div>
    
    <div class="ctrl">
      <label>R (Î©) <span id="Rval">1.0k</span></label>
      <input id="R" type="range" min="0" max="7" step="0.01" value="3">
      <div class="row">
        <input id="Rnum" type="number" min="0.001" max="10000000" step="any" value="1">
        <select id="Runit">
          <option value="1">Î©</option>
          <option value="1000" selected>kÎ©</option>
          <option value="1000000">MÎ©</option>
        </select>
      </div>
      <div class="tags">Resistance: Ï„ = RÂ·C (1Î© - 10MÎ©)</div>
    </div>
    
    <div class="ctrl">
      <label>C (F) <span id="Cval">100Î¼</span></label>
      <input id="C" type="range" min="-12" max="0" step="0.01" value="-4">
      <div class="row">
        <input id="Cnum" type="number" min="1e-12" max="1" step="any" value="100">
        <select id="Cunit">
          <option value="1e-12">pF</option>
          <option value="1e-9">nF</option>
          <option value="1e-6" selected>Î¼F</option>
          <option value="1e-3">mF</option>
          <option value="1">F</option>
        </select>
      </div>
      <div class="tags">Capacitance: vâ‚€ = 0 (1pF - 1F)</div>
    </div>
    
    <div class="ctrl">
      <label>Frequency f (Hz) <span id="Fval">1.0</span></label>
      <input id="F" type="range" min="-3" max="6" step="0.01" value="0">
      <div class="row">
        <input id="Fnum" type="number" min="0.001" max="1000000" step="any" value="1">
        <select id="Funit">
          <option value="1" selected>Hz</option>
          <option value="1000">kHz</option>
          <option value="1000000">MHz</option>
        </select>
      </div>
      <div class="tags">Signal frequency: 0.001Hz - 1MHz</div>
    </div>
    
    <div class="ctrl">
      <label>Duration T (s) <span id="Tval">4.00</span></label>
      <input id="T" type="range" min="1" max="10" step="0.1" value="4">
      <div class="row">
        <input id="Tnum" type="number" min="1" max="10" step="0.1" value="4">
        <button id="reset">Reset Circuit</button>
      </div>
      <div class="checkbox-container">
        <input id="showInput" type="checkbox" checked>
        <label for="showInput">Show input signal U(t)</label>
      </div>
    </div>
  </div>

  <div class="plot-container">
    <div id="plot" style="width:100%;height:520px;"></div>
  </div>

  <!-- Meme Section for some physics humor! -->
  <div class="meme-section">
    <div class="meme-container">
      <img src="photo1.jpg" alt="Physics Meme 1" loading="lazy">
      <div class="meme-caption">When you finally understand RC circuits ðŸ”¬</div>
    </div>
    <div class="meme-container">
      <img src="photo2.jpg" alt="Physics Meme 2" loading="lazy">
      <div class="meme-caption">Capacitors charging up like... âš¡</div>
    </div>
  </div>
</div>

<script>
const N = 2000;

function linspace(a,b,n){
  const d=(b-a)/(n-1), x=new Array(n);
  for(let i=0;i<n;i++) x[i]=a+i*d;
  return x;
}

function generateWaveform(type, f, t) {
  const waveforms = new Array(t.length);
  
  for(let i = 0; i < t.length; i++) {
    const phase = 2 * Math.PI * f * t[i];
    
    switch(type) {
      case 'square':
        waveforms[i] = Math.sin(phase) >= 0 ? 1 : -1;
        break;
      case 'sine':
        waveforms[i] = Math.sin(phase);
        break;
      case 'triangle':
        const trianglePhase = (phase % (2 * Math.PI)) / (2 * Math.PI);
        if (trianglePhase < 0.25) {
          waveforms[i] = 4 * trianglePhase;
        } else if (trianglePhase < 0.75) {
          waveforms[i] = 2 - 4 * trianglePhase;
        } else {
          waveforms[i] = 4 * trianglePhase - 4;
        }
        break;
      case 'sawtooth':
        const sawPhase = (phase % (2 * Math.PI)) / (2 * Math.PI);
        waveforms[i] = 2 * sawPhase - 1;
        break;
      default:
        waveforms[i] = Math.sin(phase) >= 0 ? 1 : -1; // default to square
    }
  }
  
  return waveforms;
}

function simulate(R, C, f, T, waveformType = 'square', v0 = null) {
  const t = linspace(0, T, N);
  const dt = t[1] - t[0];
  const u = generateWaveform(waveformType, f, t);
  const v = new Array(N);
  const tau = R * C;
  
  // Set proper initial condition for RC circuit
  v[0] = v0 !== null ? v0 : 0; // Start from 0V (discharged capacitor)
  
  // Simulate RC circuit using Euler's method
  for(let i = 1; i < N; i++) {
    v[i] = v[i-1] + (dt/tau) * (u[i-1] - v[i-1]);
  }
  
  return {t, u, v};
}

const els = {
  waveform: document.getElementById('waveform'),
  waveformDisplay: document.getElementById('waveformDisplay'),
  R: document.getElementById('R'), 
  Rnum: document.getElementById('Rnum'), 
  Rval: document.getElementById('Rval'),
  Runit: document.getElementById('Runit'),
  C: document.getElementById('C'), 
  Cnum: document.getElementById('Cnum'), 
  Cval: document.getElementById('Cval'),
  Cunit: document.getElementById('Cunit'),
  F: document.getElementById('F'), 
  Fnum: document.getElementById('Fnum'), 
  Fval: document.getElementById('Fval'),
  Funit: document.getElementById('Funit'),
  T: document.getElementById('T'), 
  Tnum: document.getElementById('Tnum'), 
  Tval: document.getElementById('Tval'),
  reset: document.getElementById('reset'), 
  showInput: document.getElementById('showInput')
};

// Unit formatting functions
function formatValue(value, type) {
  if (type === 'R') {
    if (value >= 1000000) return (value/1000000).toFixed(1) + 'M';
    if (value >= 1000) return (value/1000).toFixed(1) + 'k';
    return value.toFixed(1);
  } else if (type === 'C') {
    if (value >= 1e-3) return (value*1000).toFixed(0) + 'm';
    if (value >= 1e-6) return (value*1000000).toFixed(0) + 'Î¼';
    if (value >= 1e-9) return (value*1000000000).toFixed(0) + 'n';
    if (value >= 1e-12) return (value*1000000000000).toFixed(0) + 'p';
    return value.toExponential(2);
  } else if (type === 'F') {
    if (value >= 1000000) return (value/1000000).toFixed(1) + 'M';
    if (value >= 1000) return (value/1000).toFixed(1) + 'k';
    return value.toFixed(1);
  }
  return value.toFixed(2);
}

// Get actual value considering units
function getActualValue(numEl, unitEl) {
  return (+numEl.value) * (+unitEl.value);
}

// Update display value
function updateDisplay(numEl, unitEl, labelEl, type) {
  const actualValue = getActualValue(numEl, unitEl);
  labelEl.textContent = formatValue(actualValue, type);
}

// Sync slider and number input with unit handling (logarithmic sliders)
function syncWithUnits(slider, numInput, unitSelect, label, type) {
  const updateFromInput = () => {
    const actualValue = getActualValue(numInput, unitSelect);
    // Convert to log scale for slider
    if (type === 'R') {
      slider.value = Math.log10(Math.max(1, actualValue));
    } else if (type === 'C') {
      slider.value = Math.log10(Math.max(1e-12, actualValue));
    } else if (type === 'F') {
      slider.value = Math.log10(Math.max(0.001, actualValue));
    }
    updateDisplay(numInput, unitSelect, label, type);
    draw();
  };
  
  slider.addEventListener('input', () => {
    // Convert log slider value to linear
    const sliderValue = +slider.value;
    let actualValue;
    if (type === 'R') {
      actualValue = Math.pow(10, sliderValue); // 10^0 to 10^7 = 1Î© to 10MÎ©
    } else if (type === 'C') {
      actualValue = Math.pow(10, sliderValue); // 10^-12 to 10^0 = 1pF to 1F
    } else if (type === 'F') {
      actualValue = Math.pow(10, sliderValue); // 10^-3 to 10^6 = 1mHz to 1MHz
    }
    
    const unitValue = +unitSelect.value;
    numInput.value = actualValue / unitValue;
    updateDisplay(numInput, unitSelect, label, type);
    draw();
  });
  
  numInput.addEventListener('input', updateFromInput);
  unitSelect.addEventListener('change', updateFromInput);
}

// Simple sync for duration (no units)
function sync(a, b, label, fmt = (x) => x.toFixed(2)) {
  a.addEventListener('input', () => { b.value = a.value; label.textContent = fmt(+a.value); draw(); });
  b.addEventListener('input', () => { a.value = b.value; label.textContent = fmt(+b.value); draw(); });
}

// Initialize all controls
syncWithUnits(els.R, els.Rnum, els.Runit, els.Rval, 'R');
syncWithUnits(els.C, els.Cnum, els.Cunit, els.Cval, 'C');
syncWithUnits(els.F, els.Fnum, els.Funit, els.Fval, 'F');
sync(els.T, els.Tnum, els.Tval);

// Initialize displays and sliders to match input values
updateDisplay(els.Rnum, els.Runit, els.Rval, 'R');
updateDisplay(els.Cnum, els.Cunit, els.Cval, 'C');
updateDisplay(els.Fnum, els.Funit, els.Fval, 'F');

// Set initial slider positions to match input values
els.R.value = Math.log10(getActualValue(els.Rnum, els.Runit));
els.C.value = Math.log10(getActualValue(els.Cnum, els.Cunit));
els.F.value = Math.log10(getActualValue(els.Fnum, els.Funit));

let rememberedV0 = null;

// Waveform selector event listener
els.waveform.addEventListener('change', () => {
  const waveformNames = {
    'square': 'Square',
    'sine': 'Sine', 
    'triangle': 'Triangle',
    'sawtooth': 'Sawtooth'
  };
  els.waveformDisplay.textContent = waveformNames[els.waveform.value] || 'Square';
  draw();
});

els.reset.addEventListener('click', () => { 
  // Reset to original default values that give a good time constant
  els.Rnum.value = 1;
  els.Runit.value = 1000; // kÎ© = 1000Î©
  els.Cnum.value = 100;
  els.Cunit.value = 1e-6; // Î¼F = 1e-6 F
  els.Fnum.value = 1;
  els.Funit.value = 1; // Hz
  els.Tnum.value = 4;
  els.T.value = 4;
  
  // Update displays
  updateDisplay(els.Rnum, els.Runit, els.Rval, 'R');
  updateDisplay(els.Cnum, els.Cunit, els.Cval, 'C');
  updateDisplay(els.Fnum, els.Funit, els.Fval, 'F');
  els.Tval.textContent = '4.00';
  
  // Update slider positions
  els.R.value = Math.log10(getActualValue(els.Rnum, els.Runit));
  els.C.value = Math.log10(getActualValue(els.Cnum, els.Cunit));
  els.F.value = Math.log10(getActualValue(els.Fnum, els.Funit));
  
  // Reset circuit state
  rememberedV0 = null; 
  draw(); 
});

els.showInput.addEventListener('change', draw);

const layout = {
  margin:{l:50,r:20,t:10,b:40},
  xaxis:{title:'t (s)'},
  yaxis:{title:'Amplitude', rangemode:'tozero'},
  legend:{orientation:'h', x:0, y:1.1}
};

function draw(){
  const R = getActualValue(els.Rnum, els.Runit);
  const C = getActualValue(els.Cnum, els.Cunit);
  const f = getActualValue(els.Fnum, els.Funit);
  const T = +els.T.value;
  const waveformType = els.waveform.value;
  
  const {t, u, v} = simulate(R, C, f, T, waveformType, rememberedV0);
  rememberedV0 = v[v.length - 1]; // Remember the last value for continuity
  
  // Calculate time constant for display
  const tau = R * C;
  const tauFormatted = tau >= 1 ? tau.toFixed(3) + 's' :
                      tau >= 1e-3 ? (tau*1000).toFixed(1) + 'ms' :
                      tau >= 1e-6 ? (tau*1000000).toFixed(1) + 'Î¼s' :
                      tau >= 1e-9 ? (tau*1000000000).toFixed(1) + 'ns' :
                      tau.toExponential(2) + 's';
  
  const traces = [
    {
      x: t, 
      y: v, 
      mode: 'lines', 
      name: `Output v(t) [Ï„=${tauFormatted}]`,
      line: {color: '#667eea', width: 3}
    }
  ];
  
  if(els.showInput.checked) {
    traces.unshift({
      x: t, 
      y: u, 
      mode: 'lines', 
      name: `Input U(t) - ${els.waveformDisplay.textContent}`,
      line: {color: '#f5576c', width: 2, dash: 'dot'}
    });
  }
  
  Plotly.react('plot', traces, layout, {responsive: true, displayModeBar: false});
}

draw();
</script>
</body>
</html>
